# coding=utf-8
from datetime import datetime
import urllib.request
import re
import types
from bs4 import BeautifulSoup
import random
import json
import requests

foodDir = ['沙县·云吞','沙县·蒸饺','酱油鸡','小鸡炖蘑菇','农家小炒肉','清蒸鲈鱼','番茄炒蛋','M记']

def getMorseCode(text):
	dir = {
		'a':'01',
		'b':'1000',
		'c':'1010',
		'd':'100',
		'e':'0',
		'f':'0010',
		'g':'110',
		'h':'0000',
		'i':'00',
		'j':'0111',
		'k':'101',
		'l':'0100',
		'm':'11',
		'n':'10',
		'o':'111',
		'p':'0110',
		'q':'1101',
		'r':'010',
		's':'000',
		't':'1',
		'u':'001',
		'v':'0001',
		'w':'011',
		'x':'1001',
		'y':'1011',
		'z':'1100',
		'1':'01111',
		'2':'00111',
		'3':'00011',
		'4':'00001',
		'5':'00000',
		'6':'10000',
		'7':'11000',
		'8':'11100',
		'9':'11110',
		'0':'11111',
		'.':'010101',
		':':'111000',
		',':'110011',
		';':'101010',
		'?':'001100',
		'=':'10001',
		'\'':'011110',
		'/':'10010',
		'!':'101011',
		'-':'100001',
		'_':'001101',
		'"':'010010',
		'(':'10110',
		')':'101101',
		'$':'0001001',
		'&':'01000',
		'@':'011010',
		'+':'01010'}
	text = text.lower().replace(' ','')
	result = ''
	for item in text:
		result = result + dir[item]
	return result

def getDateTime():
	#获取当前时间
	_date = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
	print('当前时间： %s' % (format(_date)))
	return _date

def getIP():
	#获取当前公网IP
	url = urllib.request.urlopen("http://txt.go.sohu.com/ip/soip")
	text = bytes.decode(url.read())
	ip = re.findall(r'\d+.\d+.\d+.\d+',text)
	print('当前公网IP： %s' % ("".join(ip)))
	return ip[0]
	
def getMaketIndex():
#	#获取沪深股市指数代码
#	url = urllib.request.urlopen("https://www.myquant.cn/gm2/docs/api/index_list/")
#	html = url.read()
#	dom = BeautifulSoup(html, 'html.parser')
#	codes = dom.find("code").get_text().replace('指数代码         指数名称\r\n========================\r\n\r\n','').replace('\r\n\r\n\r\n\r\n','').replace('\r\n','\r').splitlines(False)
#	codeList = []
#	for code in codes:
#		codeNode = ('s_'+code.replace('SE.','').lower().replace(' ','\r')).splitlines(False)
#		codeList.append(codeNode)
	#获取随机指数当日数值
	codeList = [
				['s_sh000001','上证综指'],
				['s_sh000002','上证a指'],
				['s_sh000003','上证b指'],
				['s_sh000004','上证工业类指数'],
				['s_sh000005','上证商业类指数'],
				['s_sh000006','上证房地产指数'],
				['s_sh000007','上证公用事业股指数'],
				['s_sh000008','上证综合股指数'],
				['s_sh000009','上证380'],
				['s_sh000010','上证180'],
				['s_sh000015','上证红利'],
				['s_sh000016','上证50'],
				['s_sh000017','新综指'],
				['s_sh000018','180金融'],
				['s_sh000019','治理指数'],
				['s_sh000020','中型综指'],
				['s_sh000021','180治理'],
				['s_sh000025','180基建'],
				['s_sh000026','180资源'],
				['s_sh000027','180运输'],
				['s_sh000028','180成长'],
				['s_sh000029','180价值'],
				['s_sh000030','180r成长'],
				['s_sh000031','180r价值'],
				['s_sh000032','上证能源'],
				['s_sh000033','上证材料'],
				['s_sh000034','上证工业'],
				['s_sh000035','上证可选'],
				['s_sh000036','上证消费'],
				['s_sh000037','上证医药'],
				['s_sh000038','上证金融'],
				['s_sh000039','上证信息'],
				['s_sh000040','上证电信'],
				['s_sh000041','上证公用'],
				['s_sh000042','上证央企'],
				['s_sh000043','超大盘'],
				['s_sh000044','上证中盘'],
				['s_sh000045','上证小盘'],
				['s_sh000046','上证中小'],
				['s_sh000047','上证全指'],
				['s_sh000048','责任指数'],
				['s_sh000049','上证民企'],
				['s_sh000050','50等权'],
				['s_sh000051','180等权'],
				['s_sh000052','50基本'],
				['s_sh000053','180基本'],
				['s_sh000054','上证海外'],
				['s_sh000055','上证地企'],
				['s_sh000056','上证国企'],
				['s_sh000057','全指成长'],
				['s_sh000058','全指价值'],
				['s_sh000059','全r成长'],
				['s_sh000060','全r价值'],
				['s_sh000062','上证沪企'],
				['s_sh000063','上证周期'],
				['s_sh000064','非周期'],
				['s_sh000065','上证龙头'],
				['s_sh000066','上证商品'],
				['s_sh000067','上证新兴'],
				['s_sh000068','上证资源'],
				['s_sh000069','消费80'],
				['s_sh000070','能源等权'],
				['s_sh000071','材料等权'],
				['s_sh000072','工业等权'],
				['s_sh000073','可选等权'],
				['s_sh000074','消费等权'],
				['s_sh000075','医药等权'],
				['s_sh000076','金融等权'],
				['s_sh000077','信息等权'],
				['s_sh000078','电信等权'],
				['s_sh000079','公用等权'],
				['s_sh000090','上证流通'],
				['s_sh000091','沪财中小'],
				['s_sh000092','资源50'],
				['s_sh000093','180分层'],
				['s_sh000094','上证上游'],
				['s_sh000095','上证中游'],
				['s_sh000096','上证下游'],
				['s_sh000097','高端装备'],
				['s_sh000098','上证f200'],
				['s_sh000099','上证f300'],
				['s_sh000100','上证f500'],
				['s_sh000102','沪投资品'],
				['s_sh000103','沪消费品'],
				['s_sh000104','380能源'],
				['s_sh000105','380材料'],
				['s_sh000106','380工业'],
				['s_sh000107','380可选'],
				['s_sh000108','380消费'],
				['s_sh000109','380医药'],
				['s_sh000110','380金融'],
				['s_sh000111','380信息'],
				['s_sh000112','380电信'],
				['s_sh000113','380公用'],
				['s_sh000114','持续产业'],
				['s_sh000115','380等权'],
				['s_sh000117','380成长'],
				['s_sh000118','380价值'],
				['s_sh000119','380r成长'],
				['s_sh000120','380r价值'],
				['s_sh000121','医药主题'],
				['s_sh000122','农业主题'],
				['s_sh000123','上证180动态'],
				['s_sh000125','上证180稳定'],
				['s_sh000126','上证消费50'],
				['s_sh000128','380基本'],
				['s_sh000129','180波动'],
				['s_sh000130','380波动'],
				['s_sh000131','上证高新'],
				['s_sh000132','上证100'],
				['s_sh000133','上证150'],
				['s_sh000134','上证银行'],
				['s_sh000135','上证180高贝塔'],
				['s_sh000136','上证180低贝塔'],
				['s_sh000137','上证380高贝塔'],
				['s_sh000138','上证380低贝塔'],
				['s_sh000141','上证380动态'],
				['s_sh000142','上证380稳定'],
				['s_sh000145','优势资源'],
				['s_sh000146','优势制造'],
				['s_sh000147','优势消费'],
				['s_sh000148','消费领先'],
				['s_sh000149','上证180红利'],
				['s_sh000150','上证380红利'],
				['s_sh000151','上证国企红利'],
				['s_sh000152','上证央企红利'],
				['s_sh000153','上证民企红利'],
				['s_sh000155','上证市值百强'],
				['s_sh000158','上证环保'],
				['s_sh000159','沪股通'],
				['s_sh000160','沪新丝路'],
				['s_sh000802','500沪市'],
				['s_sh000849','300非银'],
				['s_sh000850','300有色'],
				['s_sh000901','小康指数'],
				['s_sh000970','esg 40'],
				['s_sh000972','300沪市'],
				['s_sh000976','新华金牛'],
				['s_sh000999','两岸三地'],
				['s_sz399001','深证成指'],
				['s_sz399002','深成指r'],
				['s_sz399003','深成b指'],
				['s_sz399004','深证100r'],
				['s_sz399005','中小板指'],
				['s_sz399006','创业板指'],
				['s_sz399007','深证300'],
				['s_sz399008','中小300'],
				['s_sz399009','深证200'],
				['s_sz399010','深证700'],
				['s_sz399011','深证1000'],
				['s_sz399012','创业300'],
				['s_sz399013','深市精选'],
				['s_sz399015','中小创新'],
				['s_sz399100','深证新综指'],
				['s_sz399101','中小板综'],
				['s_sz399102','创业板综'],
				['s_sz399106','深证综指'],
				['s_sz399107','深证a指'],
				['s_sz399108','深证b指'],
				['s_sz399231','农林指数'],
				['s_sz399232','采矿指数'],
				['s_sz399233','制造指数'],
				['s_sz399234','水电指数'],
				['s_sz399235','建筑指数'],
				['s_sz399236','批零指数'],
				['s_sz399237','运输指数'],
				['s_sz399238','餐饮指数'],
				['s_sz399239','it指数'],
				['s_sz399240','金融指数'],
				['s_sz399241','地产指数'],
				['s_sz399242','商务指数'],
				['s_sz399243','科研指数'],
				['s_sz399244','公共指数'],
				['s_sz399248','文化指数'],
				['s_sz399249','综企指数'],
				['s_sz399300','沪深300'],
				['s_sz399303','国证2000'],
				['s_sz399310','国证50'],
				['s_sz399311','国证1000'],
				['s_sz399312','国证300'],
				['s_sz399313','巨潮100'],
				['s_sz399314','巨潮大盘'],
				['s_sz399315','巨潮中盘'],
				['s_sz399316','巨潮小盘'],
				['s_sz399317','国证a指'],
				['s_sz399318','国证b指'],
				['s_sz399319','资源优势'],
				['s_sz399320','国证服务'],
				['s_sz399321','国证红利'],
				['s_sz399322','国证治理'],
				['s_sz399324','深证红利'],
				['s_sz399326','成长40'],
				['s_sz399328','深证治理'],
				['s_sz399330','深证100'],
				['s_sz399332','深证创新'],
				['s_sz399333','中小板指r'],
				['s_sz399335','深证央企'],
				['s_sz399337','深证民营'],
				['s_sz399339','深证科技'],
				['s_sz399341','深证责任'],
				['s_sz399344','深证300r'],
				['s_sz399346','深证成长'],
				['s_sz399348','深证价值'],
				['s_sz399350','皖江30'],
				['s_sz399351','深圳报业指数'],
				['s_sz399352','深报综指'],
				['s_sz399353','国证物流'],
				['s_sz399354','分析师指数'],
				['s_sz399355','cbn长江'],
				['s_sz399356','cbn珠江'],
				['s_sz399357','cbn渤海'],
				['s_sz399358','泰达环保指数'],
				['s_sz399359','国证基建'],
				['s_sz399360','国证装备'],
				['s_sz399361','国证商业'],
				['s_sz399362','国证民营'],
				['s_sz399363','计算机指'],
				['s_sz399364','中金消费'],
				['s_sz399365','国证农业'],
				['s_sz399366','国证大宗'],
				['s_sz399367','巨潮地产'],
				['s_sz399368','国证军工'],
				['s_sz399369','cbn-兴全'],
				['s_sz399370','国证成长'],
				['s_sz399371','国证价值'],
				['s_sz399372','大盘成长'],
				['s_sz399373','大盘价值'],
				['s_sz399374','中盘成长'],
				['s_sz399375','中盘价值'],
				['s_sz399376','小盘成长'],
				['s_sz399377','小盘价值'],
				['s_sz399378','南方低碳'],
				['s_sz399381','1000能源'],
				['s_sz399382','1000材料'],
				['s_sz399383','1000工业'],
				['s_sz399384','1000可选'],
				['s_sz399385','1000消费'],
				['s_sz399386','1000医药'],
				['s_sz399387','1000金融'],
				['s_sz399388','1000信息'],
				['s_sz399389','国证通信'],
				['s_sz399390','1000公用'],
				['s_sz399391','投资时钟'],
				['s_sz399392','国证新兴'],
				['s_sz399393','国证地产'],
				['s_sz399394','国证医药'],
				['s_sz399395','国证有色'],
				['s_sz399396','国证食品'],
				['s_sz399397','oct文化'],
				['s_sz399398','绩效指数'],
				['s_sz399399','中经gdp'],
				['s_sz399400','大中盘'],
				['s_sz399401','中小盘'],
				['s_sz399402','周期100'],
				['s_sz399403','防御100'],
				['s_sz399404','大盘低波'],
				['s_sz399405','大盘高贝'],
				['s_sz399406','中盘低波'],
				['s_sz399407','中盘高贝'],
				['s_sz399408','小盘低波'],
				['s_sz399409','小盘高贝'],
				['s_sz399410','苏州率先'],
				['s_sz399411','红利100'],
				['s_sz399412','国证新能'],
				['s_sz399415','i100'],
				['s_sz399416','i300'],
				['s_sz399417','新能源车'],
				['s_sz399418','国证国安'],
				['s_sz399419','国证高铁'],
				['s_sz399420','国证保证'],
				['s_sz399423','中关村50'],
				['s_sz399427','专利领先'],
				['s_sz399428','国证定增'],
				['s_sz399429','新丝路'],
				['s_sz399431','国证银行'],
				['s_sz399432','国证汽车'],
				['s_sz399433','国证交运'],
				['s_sz399434','国证传媒'],
				['s_sz399435','国证农牧'],
				['s_sz399436','国证煤炭'],
				['s_sz399437','国证证券'],
				['s_sz399438','国证电力'],
				['s_sz399439','国证油气'],
				['s_sz399440','国证钢铁'],
				['s_sz399441','生物医药'],
				['s_sz399550','央视50'],
				['s_sz399551','央视创新'],
				['s_sz399552','央视成长'],
				['s_sz399553','央视回报'],
				['s_sz399554','央视治理'],
				['s_sz399555','央视责任'],
				['s_sz399556','央视生态'],
				['s_sz399557','央视文化'],
				['s_sz399602','中小成长'],
				['s_sz399604','中小价值'],
				['s_sz399606','创业板指r'],
				['s_sz399608','科技100'],
				['s_sz399610','tmt50'],
				['s_sz399611','中创100r'],
				['s_sz399612','中创100'],
				['s_sz399613','深证能源'],
				['s_sz399614','深证材料'],
				['s_sz399615','深证工业'],
				['s_sz399616','深证可选'],
				['s_sz399617','深证消费'],
				['s_sz399618','深证医药'],
				['s_sz399619','深证金融'],
				['s_sz399620','深证信息'],
				['s_sz399621','深证电信'],
				['s_sz399622','深证公用'],
				['s_sz399623','中小基础'],
				['s_sz399624','中创400'],
				['s_sz399625','中创500'],
				['s_sz399626','中创500成长'],
				['s_sz399627','中创500价值'],
				['s_sz399628','700成长'],
				['s_sz399629','700价值'],
				['s_sz399630','1000成长'],
				['s_sz399631','1000价值'],
				['s_sz399632','深100ew'],
				['s_sz399633','深300ew'],
				['s_sz399634','中小板ew'],
				['s_sz399635','创业板ew'],
				['s_sz399636','深证装备'],
				['s_sz399637','深证地产'],
				['s_sz399638','深证环保'],
				['s_sz399639','深证大宗'],
				['s_sz399640','创业基础'],
				['s_sz399641','深证新兴'],
				['s_sz399642','中小新兴'],
				['s_sz399643','创业新兴'],
				['s_sz399644','深证时钟'],
				['s_sz399645','100低波'],
				['s_sz399646','深消费50'],
				['s_sz399647','深医药50'],
				['s_sz399648','深证gdp100'],
				['s_sz399649','中小板红利'],
				['s_sz399650','中小板治理'],
				['s_sz399651','中小板责任'],
				['s_sz399652','中创高新'],
				['s_sz399653','深证龙头'],
				['s_sz399654','深证文化'],
				['s_sz399655','深证绩效'],
				['s_sz399656','100绩效'],
				['s_sz399657','300绩效'],
				['s_sz399658','中小绩效'],
				['s_sz399659','深成指ew'],
				['s_sz399660','中创ew'],
				['s_sz399661','深证低波'],
				['s_sz399662','深证高贝'],
				['s_sz399663','中小低波'],
				['s_sz399664','中小高贝'],
				['s_sz399665','中创低波'],
				['s_sz399666','中创高贝'],
				['s_sz399667','创业板g'],
				['s_sz399668','创业板v'],
				['s_sz399669','深证农业'],
				['s_sz399670','深周期50'],
				['s_sz399671','深防御50'],
				['s_sz399672','深红利50'],
				['s_sz399673','创业板50'],
				['s_sz399674','深a医药'],
				['s_sz399675','深互联网'],
				['s_sz399676','深医药ew'],
				['s_sz399677','深互联ew'],
				['s_sz399678','深次新股'],
				['s_sz399679','深证200r'],
				['s_sz399701','深证f60'],
				['s_sz399702','深证f120'],
				['s_sz399703','深证f200'],
				['s_sz399704','深证上游'],
				['s_sz399705','深证中游'],
				['s_sz399706','深证下游'],
				['s_sz399802','500深市'],
				['s_sz399901','小康指数'],
				['s_sz399908','沪深300能源'],
				['s_sz399909','沪深300材料'],
				['s_sz399910','沪深300工业'],
				['s_sz399911','沪深300可选'],
				['s_sz399912','沪深300消费'],
				['s_sz399913','沪深300医药'],
				['s_sz399914','沪深300金融'],
				['s_sz399915','沪深300信息'],
				['s_sz399916','沪深300电信'],
				['s_sz399917','沪深300公用'],
				['s_sz399918','沪深300成长'],
				['s_sz399919','沪深300价值'],
				['s_sz399920','沪深300r成长'],
				['s_sz399925','基本面50'],
				['s_sz399927','央企100'],
				['s_sz399939','民企200'],
				['s_sz399941','新能源'],
				['s_sz399942','内地消费'],
				['s_sz399943','内地基建'],
				['s_sz399944','内地资源'],
				['s_sz399945','内地运输'],
				['s_sz399946','内地金融'],
				['s_sz399947','内地银行'],
				['s_sz399948','内地地产'],
				['s_sz399949','内地农业'],
				['s_sz399950','300基建'],
				['s_sz399951','300银行'],
				['s_sz399952','300地产'],
				['s_sz399954','地企100'],
				['s_sz399956','国企200'],
				['s_sz399957','300运输'],
				['s_sz399958','创业成长'],
				['s_sz399968','300周期'],
				['s_sz399969','300非周'],
				['s_sz399972','300深市'],
				['s_sz399977','内地低碳'],
				['s_sz399978','医药100'],
				['s_sz399979','大宗商品'],
				['s_sz399982','500等权']]
	todayCode = codeList[random.randint(0,len(codeList)-1)]
	codeUrl = BeautifulSoup(urllib.request.urlopen('http://hq.sinajs.cn/list=' + todayCode[0]).read(), 'html.parser').string.replace(',','\n').splitlines(False)
	print('当前%s： %s' %(todayCode[1],codeUrl[1]))
	return codeUrl[1]

def getWeather():
	#获取当前天气,暂时不想做了
	print('My ip is ')

def getLocation():
	#获取地理位置,下面这个API将香港分到了国家里，我暂时找不到更加适合的API。仅当实验使用
	data = requests.get('http://ip-api.com/json/').json()
	print('当前所在城市： %s' %(data['regionName']))
	return data['regionName']

def getImpactFactor(lenx):
	#获取当前影响因子
	ip = getIP()
	dateTime = getDateTime()
	maketIndex = getMaketIndex()
	location = getLocation();
	impactFactorStr = codeConver(ip,maketIndex,dateTime,location)
	impactFactorNum = impactFactorStr.count('1') + impactFactorStr.count('0')  + random.randint(0,1000)
	impactFactor = round((impactFactorNum * lenx) / 10**len(str(impactFactorNum)))
	print('当前原始影响因子： %s' %(impactFactorNum))
	print('当前影响因子： %s' %(impactFactor))
	return impactFactor

def codeConver(*values):
	result = ''
	for value in values:
		result = result + getMorseCode(value)
	return result
	
def getFood(randomNum):
	return foodDir[randomNum]
if __name__ == '__main__':
	food = getFood(getImpactFactor(len(foodDir)))
	print('建议吃的菜品是： %s' %(food))